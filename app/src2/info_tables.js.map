{"version":3,"sources":["info_tables.es6"],"names":[],"mappings":"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","file":"info_tables.js","sourcesContent":["/**\n * Created by yarden on 8/21/15.\n */\n\nimport d3 from 'd3';\nimport * as postal from 'postal'\n\nimport * as patients from './patients';\nimport {topics} from './service';\n\nimport table from './components/table';\nimport bar from './components/bar';\n\nlet container = d3.select('#details-tables');\nlet topicsMap = new Map();\n\nlet cat = Table(container)\n    .id('cat-table')\n    .header([\n      {name: 'key', title: 'Category'},\n      {name: 'value', title: '#tags', attr:'numeric'}])\n    .dimension(patients.topics_cat);\n\nlet sys = Table(container)\n    .id('sys-table')\n    .header([\n      {name: 'key', title: 'System'},\n      {name: 'value', title: '#tags', attr:'numeric'}])\n    .dimension(patients.topics_sys);\n\nlet bars = bar();\nlet tags = Table(container)\n  .id('tags-table')\n  .header([\n    {name: 'key', title: 'Concept', cellAttr: r => r.attr && r.attr.name},\n    {name: 'value', title: 'Encounters', render: bars}])\n  .dimension(patients.rel_tid)\n  .update( list => list.map( d => ({key: topicsMap.get(d.key), value: d.value}) ));\n  //.on('mouseover', function(d) { post.publish('tag.highlight', {name: d.value, show: true}); })\n  //.on('mouseout', function(d) { post.publish('tag.highlight', {name: d.value, show: false}); })\n  //.on('click', function(d) {\n  //  if (d3.event.shiftKey) selection.exclude(d.row.tag);\n  //  else selection.select(d.row.tag);\n  //});\n\npostal.subscribe({channel: 'global', topic: 'render', callback: render});\n\nexport function init() {\n  for (let topic of topics) topicsMap.set(topic.id, topic.label);\n}\n\nfunction reset() {\n}\n\nfunction render() {\n  cat.render();\n  sys.render();\n  tags.render();\n}\n\nfunction Table(div) {\n  let selected = new Set();\n  let excluded = new Set();\n  let dimension;\n  let dirty = false;\n  let inner = table(div);\n  let update = v => v;\n\n  inner\n    .on('click', function(d) {\n      dirty = true;\n      if (selected.delete(d.value)) {\n        d3.select(this)\n          .classed('selected', false);\n      } else {\n        d3.select(this)\n          .classed('selected', true);\n        selected.add(d.value)\n      }\n      if (selected.size == 0)\n        dimension.filterAll();\n      else\n        dimension.filter( v => selected.has(v) );\n      patients.update(dimension);\n      postal.publish({channel: 'global', topic: 'render'});\n    });\n\n  function api(selection) {\n    return this;\n  }\n\n  api.id = function(_) {\n    inner.id(_);\n    return this;\n  };\n\n  api.header = function(_) {\n    inner.header(_);\n    return this;\n  };\n\n  api.dimension = function(_) {\n    dimension = _;\n    return this;\n  };\n\n  api.render = function() {\n    if (dirty) { dirty = false; }\n    else {\n      inner.data(update(dimension.group().top(Infinity)));\n    }\n    return this;\n  };\n\n  api.update = function(f) {\n    update = f;\n    return this;\n  };\n\n  return api;\n}"]}