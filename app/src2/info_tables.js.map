{"version":3,"sources":["info_tables.es6"],"names":[],"mappings":"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","file":"info_tables.js","sourcesContent":["/**\n * Created by yarden on 8/21/15.\n */\n\nimport d3 from 'd3';\nimport postal from 'postal'\n\nimport * as patients from './patients';\nimport {topicsMap} from './service';\nimport * as tagSelection from './tag_selection';\n\nimport table from './components/table';\nimport bar from './components/bar';\n\nlet container = d3.select('#details-tables');\n\nlet cat = Table(container)\n    .id('cat-table')\n    .header([\n      {name: 'key', title: 'Category'},\n      {name: 'value', title: '#tags', attr:'numeric'}])\n    .dimension(patients.topics_cat);\n\nlet sys = Table(container)\n    .id('sys-table')\n    .header([\n      {name: 'key', title: 'System'},\n      {name: 'value', title: '#tags', attr:'numeric'}])\n    .dimension(patients.topics_sys);\n\nlet bars = bar();\nlet tags = RelTable(container)\n  .id('tags-table')\n  .header([\n    {name: 'topic', title: 'Topic', cellAttr: r => r.attr && r.attr.name},\n    {name: 'value', title: 'Encounters', render: bars}])\n  .in_dimension(patients.rel_tid);\n  //.out_dimension(patients.enc_tags);\n  //.on('mouseover', function(d) { post.publish('tag.highlight', {name: d.value, show: true}); })\n  //.on('mouseout', function(d) { post.publish('tag.highlight', {name: d.value, show: false}); })\n\n\npostal.subscribe({channel: 'global', topic: 'render', callback: render});\n\nexport function init() {\n  //for (let topic of topics) topicsMap.set(topic.id, topic.label);\n}\n\nfunction reset() {\n}\n\nfunction render() {\n  cat.render();\n  sys.render();\n  tags.render();\n}\n\nfunction Table(div) {\n  let selected = new Set();\n  let excluded = new Set();\n  let dimension;\n  let group;\n\n  let inner = table(div)\n    .on('click',  function click(d) {\n      if (d3.event.metaKey) {\n        if (!excluded.delete(d.value)) excluded.add(d.value);\n        selected.delete(d.value);\n      } else {\n        if (!selected.delete(d.value)) selected.add(d.value);\n        excluded.delete(d.value);\n      }\n\n      d.row.classes = { selected: selected.has(d.value), excluded: excluded.has(d.value)};\n\n      if (selected.size == 0 && excluded.size == 0)\n        dimension.filterAll();\n      else\n        dimension.filter( v => (selected.size == 0 || selected.has(v)) && (excluded.size == 0 || !excluded.has(v)) );\n\n      patients.update(dimension);\n      postal.publish({channel: 'global', topic: 'render'});\n    });\n\n  function api(selection) {\n    return this;\n  }\n\n  api.id = function(_) {\n    inner.id(_);\n    return this;\n  };\n\n  api.header = function(_) {\n    inner.header(_);\n    return this;\n  };\n\n  api.dimension = function(_) {\n    dimension = _;\n    if (group) group.dispose();\n    group = dimension.group();\n    return this;\n  };\n\n  api.render = function() {\n    inner.data(group.all());\n    return this;\n  };\n\n  return api;\n}\n\nfunction RelTable(div) {\n  let in_dimension;\n  let in_group;\n  let out_dimension;\n\n  let inner = table(div)\n    .on('click',  function click(d) {\n      let key = d.row.key.tid;\n\n      if (d3.event.metaKey) tagSelection.exclude(key);\n      else  tagSelection.select(key);\n    });\n\n  function api(selection) {\n    return this;\n  }\n\n  api.id = function(_) {\n    inner.id(_);\n    return this;\n  };\n\n  api.header = function(_) {\n    inner.header(_);\n    return this;\n  };\n\n  api.in_dimension = function(_) {\n    in_dimension = _;\n    if (in_group) in_group.dispose();\n    in_group = in_dimension.group();\n    return this;\n  };\n\n  api.out_dimension = function(_) {\n    out_dimension = _;\n    return this;\n  };\n\n  api.render = function() {\n    let items = in_group.all();\n    let max = 0;\n    for (let item of items) {\n      item.topic = topicsMap.get(item.key.tid).label;\n      item.classes = {\n        'selected': tagSelection.isSelected(item.key.tid),\n        'excluded': tagSelection.isExcluded(item.key.tid)\n      };\n      max = Math.max(max, item.value);\n    }\n    bars.max(max);\n    inner.data( items );\n    return this;\n  };\n\n  return api;\n}"]}