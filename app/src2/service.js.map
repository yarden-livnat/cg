{"version":3,"sources":["service.es6"],"names":[],"mappings":";;;;;;;;;;UAcgB,IAAI,GAAJ,IAAI;UAoBJ,KAAK,GAAL,KAAK;;;;;;;;AA3BrB,MAAI,UAAU,GAAG,gBAAG,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;;AAErC,MAAI,MAAM,GAAG,EAAE,CAAC;UAAZ,MAAM,GAAN,MAAM;AACV,MAAI,SAAS,GAAG,IAAI,GAAG,EAAE,CAAC;UAAtB,SAAS,GAAT,SAAS;AACb,MAAI,SAAS,GAAG,EAAE,CAAC;UAAf,SAAS,GAAT,SAAS;AACb,MAAI,SAAS,GAAG,EAAE,CAAC;;UAAf,SAAS,GAAT,SAAS;;AAEb,WAAS,IAAI,CAAC,EAAE,EAAE;AACrB,6BAAO,CACJ,KAAK,CAAC,gBAAG,IAAI,EAAE,UAAU,CAAC,CAC1B,KAAK,CAAC,gBAAG,IAAI,EAAE,iBAAiB,CAAC,CACjC,KAAK,CAAC,gBAAG,IAAI,EAAE,iBAAiB,CAAC,CACjC,KAAK,CAAE,UAAC,GAAG,EAAE,EAAE,EAAE,aAAa,EAAE,aAAa,EAAK;AACjD,UAAI,CAAC,GAAG,EAAE;AACR,UAAE,CAAC,OAAO,CAAC,UAAA,CAAC,EAAI;AACd,WAAC,CAAC,KAAK,GAAG,CAAC,CAAC,OAAO,IAAI,EAAE,GAAG,CAAC,CAAC,IAAI,GAAG,CAAC,CAAC,IAAI,GAAC,GAAG,GAAC,CAAC,CAAC,OAAO,GAAC,GAAG,CAAC;AAC9D,mBAAS,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;SACxB,CAAC,CAAC;;AAEH,gBAjBC,MAAM,GAiBP,MAAM,GAAG,EAAE,CAAC;AACZ,gBAhBC,SAAS,GAgBV,SAAS,GAAG,aAAa,CAAC;AAC1B,gBAhBC,SAAS,GAgBV,SAAS,GAAG,aAAa,CAAC;OAC3B;AACD,QAAE,CAAC,GAAG,CAAC,CAAC;KACT,CAAC,CAAC;GACR;;AAEM,WAAS,KAAK,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,EAAE,EAAE;AAC3C,QAAI,OAAO,KAAK,IAAI,QAAQ,EAAE,KAAK,GAAG,CAAC,KAAK,CAAC,CAAC;AAC9C,QAAI,IAAI,YAAY,IAAI,EAAE,IAAI,GAAG,UAAU,CAAC,IAAI,CAAC,CAAC;AAClD,QAAI,EAAE,YAAY,IAAI,EAAE,EAAE,GAAG,UAAU,CAAC,EAAE,CAAC,CAAC;;AAE5C,WAAO,IAAI,OAAO,CAChB,UAAU,OAAO,EAAE,MAAM,EAAE;;AAEzB,sBAAG,IAAI,CAAC,GAAG,GAAC,IAAI,CAAC,CACd,MAAM,CAAC,cAAc,EAAE,kBAAkB,CAAC,CAC1C,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,EAC1D,UAAS,KAAK,EAAE,IAAI,EAAE;AACpB,YAAI,KAAK,EAAE,MAAM,CAAC,KAAK,CAAC,CAAC,KACpB,OAAO,CAAC,IAAI,CAAC,CAAC;OACpB,CAAC,CAAA;KACL,CAAC,CAAC;GACN","file":"service.js","sourcesContent":["/**\n * Created by yarden on 8/21/15.\n */\n\nimport d3 from 'd3';\nimport queue from 'queue';\n\nlet dateFormat = d3.time.format('%Y-%m-%d');\n\nexport let topics = [];\nexport let topicsMap = new Map();\nexport let pathogens = [];\nexport let detectors = [];\n\nexport function init(cb) {\n    queue()\n      .defer(d3.json, '/data/kb')\n      .defer(d3.json, '/info/pathogens')\n      .defer(d3.json, '/info/detectors')\n      .await( (err, kb, pathogensList, detectorsList) => {\n        if (!err) {\n          kb.forEach(d => {\n            d.label = d.details == '' ? d.name : d.name+'['+d.details+']';\n            topicsMap.set(d.id, d);\n          });\n\n          topics = kb;\n          pathogens = pathogensList;\n          detectors = detectorsList;\n        }\n        cb(err);\n      });\n}\n\nexport function fetch(type, names, from, to) {\n  if (typeof names == 'string') names = [names];\n  if (from instanceof Date) from = dateFormat(from);\n  if (to instanceof Date) to = dateFormat(to);\n\n  return new Promise(\n    function (resolve, reject) {\n      //startSpinner();\n      d3.json('/'+type)\n        .header(\"Content-Type\", \"application/json\")\n        .post(JSON.stringify({ names: names, from: from, to: to }),\n        function(error, data) {\n          if (error) reject(error);\n          else resolve(data);\n        })\n    });\n}"]}