{"version":3,"sources":["info_detectors.es6"],"names":[],"mappings":"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","file":"info_detectors.js","sourcesContent":["/**\n * Created by yarden on 8/18/15.\n */\n\nimport d3 from 'd3';\nimport postal from 'postal';\n\n//import * as data from '../data'\nimport {fetch} from './service';\nimport Detector from './components/detector';\n\nexport default function() {\n\n  const N_BINS = 20;\n\n  postal.subscribe({channel: 'global', topic: 'data.changed', callback: dataChanged});\n  postal.subscribe({channel: 'global', topic: 'render', callback: render});\n\n  let selection;\n  let detectorClass = Detector();\n  let detectors = [];\n  let detectorsData = [];\n  let range = d3.range(0.5, 1, 0.5/N_BINS);\n\n  function init(list) {\n    detectors = list;\n    d3.select('#detectors').selectAll('div')\n      .data(list)\n      .enter()\n        .append('div')\n        .attr('id', d => 'detector-'+d.name)\n        .attr('class', 'detector')\n        .call(detectorClass.build);\n  }\n\n  function dataChanged(data) {\n    fetch('detectors',detectors.map(d => d.name), data.from, data.to)\n      .then( reply => {\n        detectorsData = reply;\n        for (let i=0; i<reply.length; i++) {\n          let detector = detectors[i];\n          let data = reply[i];\n          detector.eid.filterAll();\n          detector.prob.filterAll();\n          detector.cf.remove();\n          detector.cf.add(data.rows);\n        }\n        render();\n      })\n      .catch( e => { console.error('Detectors error:', e); });\n  }\n\n  function render() {\n    let list = [];\n    for (let detector of detectors) {\n      let hist = range.map(d => ({x: d, p: 0, s: 0}));\n\n      detector.prob.group( p => Math.floor((p-0.5)/0.5 * N_BINS)).top(Infinity)\n        .forEach( d => { if (d.key >= 0) hist[d.key].p = d.value; });\n\n      detector.similar.group( p => Math.floor((p-0.5)/0.5 * N_BINS)).top(Infinity)\n        .forEach( d => { if (d.key >= 0) hist[d.key].s = d.value; });\n\n      list.push( {id: detector.name, data: hist} );\n    }\n\n    detectorClass(d3.select('#detectors').selectAll('.detector').data(list));\n  }\n\n  return {\n    init : init\n  }\n}"]}