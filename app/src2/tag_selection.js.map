{"version":3,"sources":["tag_selection.es6"],"names":[],"mappings":";;;;;;;;;;UAuCgB,MAAM,GAAN,MAAM;UAMN,OAAO,GAAP,OAAO;UAMP,OAAO,GAAP,OAAO;UAIP,UAAU,GAAV,UAAU;UAIV,UAAU,GAAV,UAAU;;;;;;AAnD1B,MAAI,SAAS,GAAG,UAAS,OAAO,CAAC;AAC1B,MAAI,QAAQ,GAAG,IAAI,GAAG,EAAE,CAAC;UAArB,QAAQ,GAAR,QAAQ;AACZ,MAAI,QAAQ,GAAG,IAAI,GAAG,EAAE,CAAC;;UAArB,QAAQ,GAAR,QAAQ;AAEnB,WAAS,MAAM,CAAC,GAAG,EAAE;;;;;;AACnB,2BAAc,QAAQ;YAAb,CAAC;;AACR,YAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,OAAO,KAAK,CAAC;OAAA;;;;;;;;;;;;;;;;;;;;;AACrC,4BAAc,QAAQ;YAAb,CAAC;;AACR,YAAI,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,OAAO,KAAK,CAAC;OAAA;;;;;;;;;;;;;;;;AACpC,WAAO,IAAI,CAAC;GACb;;AAED,WAAS,gBAAgB,GAAG;AAC1B,QAAI,MAAM,GAAG,IAAI,GAAG,EAAE,CAAC;;;;;;AACvB,4BAAgB,UAAS,aAAa,CAAC,MAAM,EAAE;YAAtC,GAAG;;AACV,YAAI,MAAM,CAAC,GAAG,CAAC,EAAE,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;OAAA;;;;;;;;;;;;;;;;AACtC,WAAO,MAAM,CAAC;GACf;;AAED,WAAS,MAAM,GAAG;AAChB,QAAI,OAAO,EAAE,EACX,SAAS,CAAC,SAAS,EAAE,CAAC,KACnB;;AACH,YAAI,CAAC,GAAG,gBAAgB,EAAE,CAAC;AAC3B,iBAAS,CAAC,MAAM,CAAE,UAAA,KAAK;iBAAI,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC;SAAA,CAAE,CAAC;;KAC/C;;AAED,cAAS,MAAM,CAAC,SAAS,CAAC,CAAC;AAC3B,wBAAO,OAAO,CAAC,EAAC,OAAO,EAAE,QAAQ,EAAE,KAAK,EAAE,QAAQ,EAAC,CAAC,CAAC;GACtD;;AAEM,WAAS,MAAM,CAAC,IAAI,EAAE;AAC3B,QAAI,CAAC,QAAQ,UAAO,CAAC,IAAI,CAAC,EAAE,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;AAC/C,YAAQ,UAAO,CAAC,IAAI,CAAC,CAAC;AACtB,UAAM,EAAE,CAAC;GACV;;AAEM,WAAS,OAAO,CAAC,IAAI,EAAE;AAC5B,QAAI,CAAC,QAAQ,UAAO,CAAC,IAAI,CAAC,EAAE,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;AAC/C,YAAQ,UAAO,CAAC,IAAI,CAAC,CAAC;AACtB,UAAM,EAAE,CAAC;GACV;;AAEM,WAAS,OAAO,GAAG;AACxB,WAAO,QAAQ,CAAC,IAAI,IAAI,CAAC,IAAI,QAAQ,CAAC,IAAI,IAAI,CAAC,CAAC;GACjD;;AAEM,WAAS,UAAU,CAAC,IAAI,EAAE;AAC/B,WAAO,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;GAC3B;;AAEM,WAAS,UAAU,CAAC,IAAI,EAAE;AAC/B,WAAO,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;GAC3B","file":"tag_selection.js","sourcesContent":["/**\n * Created by yarden on 10/27/15.\n */\n\nimport * as patients from './patients';\nimport postal from 'postal';\n\n\nlet dimension = patients.rel_tid;\nexport let selected = new Set();\nexport let excluded = new Set();\n\nfunction accept(enc) {\n  for (let s of selected)\n    if (!enc.tags.has(s)) return false;\n  for (let e of excluded)\n    if (enc.tags.has(e)) return false;\n  return true;\n}\n\nfunction activeEncounters() {\n  let active = new Set();\n  for (let enc of patients.encountersMap.values())\n    if (accept(enc)) active.add(enc.id);\n  return active;\n}\n\nfunction update() {\n  if (isEmpty())\n    dimension.filterAll();\n  else {\n    let e = activeEncounters();\n    dimension.filter( entry => e.has(entry.eid) );\n  }\n\n  patients.update(dimension);\n  postal.publish({channel: 'global', topic: 'render'});\n}\n\nexport function select(item) {\n  if (!selected.delete(item)) selected.add(item);\n  excluded.delete(item);\n  update();\n}\n\nexport function exclude(item) {\n  if (!excluded.delete(item)) excluded.add(item);\n  selected.delete(item);\n  update();\n}\n\nexport function isEmpty() {\n  return selected.size == 0 && excluded.size == 0;\n}\n\nexport function isSelected(item) {\n  return selected.has(item);\n}\n\nexport function isExcluded(item) {\n  return excluded.has(item);\n}\n\n\n"]}