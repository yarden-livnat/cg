{"version":3,"sources":["table.es6"],"names":[],"mappings":"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","file":"table.js","sourcesContent":["/**\n * Created by yarden on 8/4/15.\n */\n\nimport * as d3 from 'd3'\n\nexport default function(container, id) {\n  let SORT_OP = [\n    { func: d3.ascending, symbol: \"fa-sort-asc\"},\n    { func: d3.descending, symbol: \"fa-sort-desc\"}\n  ];\n\n  container = container instanceof Array && container || d3.select(container);\n\n  let table = container.append('table'),\n      thead = table.append('thead').append('tr'),\n      tbody = table.append('tbody'),\n      dispatch = d3.dispatch('click', 'mouseover', 'mouseout'),\n      columns,\n      sortCol, sortHeader,\n      data;\n\n  if (id) { table.attr('id', id);}\n\n  function capitalize(str, def = \"\") {\n    return str && str.length > 0 && str[0].toUpperCase() + str.substr(1) || def;\n  }\n\n  function f(field) {\n    return typeof field == 'string' ? o => o[field] : o => field;\n  }\n\n  function onSort(col) {\n    if (sortHeader == this) {\n      col.sortOrder = !col.sortOrder;\n    } else if (sortHeader) {\n      d3.select(sortHeader).classed('asc desc', false);\n    }\n\n    d3.select(this)\n      .classed({asc: col.sortOrder, desc: !col.sortOrder});\n\n    sortHeader = this;\n    sortCol = col;\n\n    sortTable();\n  }\n\n  function sortTable() {\n    if (!sortCol) return;\n    let sortFunc = sortCol.sortOrder && d3.ascending || d3.descending;\n    tbody.selectAll('tr')\n      .sort( (a, b) => sortFunc(sortCol.cellValue(a), sortCol.cellValue(b)));\n  }\n\n  return {\n    id(_) {\n      table.attr('id', _);\n    },\n\n    header(columnsDef) {\n      columnsDef = typeof columnsDef == 'string' && columnsDef.split(',') || columnsDef;\n      columns = columnsDef.map( col => {\n        col = typeof col == 'string' && { name: col } || col;\n        col.title = col.title || capitalize(col.name, '?');\n        col.cellValue = col.cellValue || f(col.name);\n        col.cellAttr = col.cellAttr || f({});\n        col.attr = col.attr || '';\n        col.sortOrder = col.sortOrder || 0;\n        col.render = col.render || 'text';\n\n        return col;\n      });\n\n      let h = thead.selectAll('th')\n        .data(columns);\n\n      h.enter().append('th')\n        .attr('class', 'tableColHeader')\n        .on('click', onSort);\n\n      h.text(c => c.title);\n\n      h.exit().remove();\n\n      h.each( function(d) { d.minWidth = d3.select(this).style('width'); });\n\n      return this;\n    },\n\n    data(list) {\n      if (!arguments.length) return data;\n\n      data = list;\n      let rows = tbody.selectAll('tr')\n        .data(list, columns[0].cellValue);\n\n      rows.enter().append('tr');\n      rows.exit().remove();\n\n      let cells = rows.selectAll('td')\n        .data(row => columns.map(c => ({ col: c, value: c.cellValue(row), attr: c.cellAttr(row), row:row })));\n\n      cells.enter().append('td')\n        .attr('class', d => d.col.attr)\n        .attr('width', d => d.col.minWidth)\n        .on('click', function(d)  {dispatch.click.apply(this, arguments); })\n        .on('mouseover', function(d) { dispatch.mouseover.apply(this, arguments); })\n        .on('mouseout', function(d) { dispatch.mouseout.apply(this, arguments); });\n\n      cells.filter(d => d.col.render == 'text')\n        .text( d => d.value)\n        .classed( d => d.attr );\n\n      for (let col of columns) {\n        if (col.render != 'text') {\n          cells.filter( d => d.col == col)\n            .call(col.render);\n        }\n      }\n\n      cells.exit().remove();\n\n      sortTable();\n\n      // adjust header cols width\n      let i = 0;\n      for (let c of tbody.select('tr').selectAll('td')[0]) {\n        columns[i++].width = parseInt(d3.select(c).style('width'));\n      }\n      if (columns.length > 0) columns[columns.length-1].width += 15;\n      thead.selectAll('th').data(columns).attr('width', d => d.width);\n\n      return this;\n    },\n\n\n    row(filter) {\n      return tbody.selectAll('tr').filter(filter);\n    },\n\n    cell(rfilter, cfilter) {\n      return row(rfilter).filter(cfilter);\n    },\n\n    on(type, cb) {\n      dispatch.on(type, cb);\n      return this;\n    }\n  }\n}"]}