{"version":3,"sources":["tagCluster.es6"],"names":[],"mappings":"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","file":"tagCluster.js","sourcesContent":["/**\n * Created by yarden on 8/25/15.\n */\n/**\n * Created by yarden on 8/24/15.\n */\n\nimport d3 from 'd3';\nimport postal from 'postal'\n\nimport {cgOptions} from '../config';\nimport {topicsMap} from '../service';\n\nimport Selector from './../components/Selector';\nimport Graph from './../graph';\n\nexport default function() {\n  let width = 200, height = 200;\n  let dimension;\n  let group;\n\n  let graph = Graph();\n  let drag = d3.behavior.drag()\n    .origin(function (d) { return {x: d.x, y: d.y}; })\n    .on('dragstart', onDragStart)\n    .on('drag', onDrag)\n    .on('dragend', onDragEnd);\n\n  let offsetX, offsetY;\n\n  function onDragStart(d, mx, my) {\n    d.fixed |= 2;\n    offsetX = d3.event.sourceEvent.layerX - x(d.x);\n    offsetY = d3.event.sourceEvent.layerY - y(d.y);\n  }\n\n\n  function onDrag(d) {\n    d3.select(this).classed(\"fixed\", d.fixed |= 3);\n    d.x = d.px = x.invert(d3.event.sourceEvent.layerX-offsetX);\n    d.y = d.py = y.invert(d3.event.sourceEvent.layerY-offsetY);\n    d3.select(this).attr('transform', function (d) {\n      return 'translate(' + x(d.x) + ',' + y(d.y) + ')';\n    });\n    d3links.call(edgeRenderer.update);\n  }\n\n  function onDragEnd(d) {\n    d.fixed &= ~6;\n  }\n\n  function dblclick(d) {\n    d3.select(this).classed(\"fixed\", d.fixed = false);\n  }\n\n  let container;\n  let svg, svgLinks, svgNodes;\n\n  let showEdges = false;\n\n  let force = d3.layout.force()\n    .on('tick', updatePosition)\n    .on('end', forceDone);\n\n  let x = d3.scale.linear()\n    .domain([0, 1])\n    .range([0, 1]);\n\n  let y = d3.scale.linear()\n    .domain([0, 1])\n    .range([0, 1]);\n\n  let nodesRange = [0, 1],\n    edgesRange = [0.7, 1];\n\n  let nodesSelector = Selector()\n    .width(100).height(50)\n    .select(nodesRange)\n    .on('select', r => {\n      nodesRange = r;\n      render(opt.canvas.fastDuration);\n      updateEdgesSelector();\n    });\n\n  let edgesSelector = Selector()\n    .width(100).height(50)\n    .select(edgesRange)\n    .on('select',  r => { edgesRange = r; render(opt.canvas.fastDuration); });\n\n  postal.subscribe({channel: 'global', topic: 'render', callback: update});\n\n  function update() {\n    let prev = new Map();\n    graph.nodes().forEach(node => prev.set(node.id, node));\n\n    graph.nodes( group.top(Infinity).map( item => {\n      let topic = topicsMap.get(item.key);\n      let node = prev.get(topic)\n        || {\n          id: item.key,\n          label: topic.label,\n          topic: topic,\n          x: Math.random() * width,\n          y: Math.random() * height,\n          scale: 1\n        };\n\n      node.items = item.value.map( entry => entry.enc_id);\n      node.items.sort( (a,b) => a - b);\n      return node;\n    }));\n\n    render(cgOptions.canvas.duration);\n  }\n\n\n\n  function updatePosition() {}\n  function forceDone() {}\n\n  function render(duration) {\n    let d3Nodes = svgNodes.selectAll('.node')\n      .data(graph.nodes(), d => d.id);\n\n    d3Nodes.enter()\n      .call(Node);\n\n    d3Nodes\n      .transition().duration(duration)\n      .style('opacity', 1)\n      .select('.scaledTag')\n      .call(scaleNode);\n\n    d3Nodes.exit()\n      .transition().duration(duration)\n      .style('opacity', 1e-6)\n      .remove();\n\n  }\n\n  function Node() {\n    let g = this.append('g')\n        .attr('class', 'node')\n        .style('opacity', 0.1)\n    //.on('mousedown', mousedown)\n    //.on('mouseup', mouseup)\n    //.on(\"dblclick\", dblclick)\n      ;\n\n    g.append('circle')\n      .attr('class', 'circle')\n      .attr('r', cgOptions.canvas.nodeRadius)\n      //.on('mouseover', mouseover)\n      //.on('mouseout', mouseout)\n    ;\n\n    let tag = g.append('g')\n      .attr('class', 'tag');\n\n    let scaled = tag.append('g')\n      .attr('class', 'scaledTag');\n\n    let frame = scaled.append('g')\n        .classed('frame', true)\n        .style('opacity', 0)\n    //.attr('visibility', 'hidden')\n      ;\n\n    frame.append('rect')\n      .classed('border', true);\n\n    frame.append('rect')\n      .classed('bg', true);\n\n    scaled.append('text')\n      .attr('class', 'tag')\n      .attr('stroke', function (d) { return d.color; })\n      .attr('fill', function (d) { return d.color; })\n      .attr('dy', '.35em')\n      .attr('text-anchor', 'start')\n      .text(function (d) {return d.label; });\n\n    scaled.each(function(d) {\n      let text = this.childNodes[1];\n      let bbox = text.getBBox();\n\n      d.w = bbox.width;\n      d.h = bbox.height;\n\n      d3.select(this).select('.bg')\n        .attr('width', bbox.width-2)\n        .attr('height', bbox.height-2)\n        .attr('x', bbox.x+1)\n        .attr('y', bbox.y+1);\n\n      d3.select(this).select('.border')\n        .attr('width', bbox.width)\n        .attr('height', bbox.height)\n        .attr('y', bbox.y);\n\n    });\n\n    scaled.call(scaleNode);\n\n    g.attr('transform', function (d) { return 'translate(' + x(d.x) + ',' + y(d.y) + ')'; });\n    g.call(drag);\n  }\n\n  function scaleNode(node) {\n    node.attr('transform', function (d) {\n        return 'translate(7, 0) scale(' + cgOptions.canvas.nodeScale(d.scale) + ')';\n      }\n    );\n  }\n\n  function build(selection) {\n    svg = selection\n      .append('svg');\n\n    svg.append('rect')\n      .attr('class', 'overlay')\n      .attr('width', width)\n      .attr('height', Math.max(0, height - edgesSelector.height() -10));\n\n    /* selectors */\n    let sg = svg.append('g')\n      .attr('class', 'cgSelectors');\n\n    nodesSelector(sg.append('g').attr('class', 'nodesSelector'));\n\n    sg.append('text')\n      .attr('transform', 'translate(20,'+(nodesSelector.height()+ 5) + ')')\n      .text('topics');\n\n    edgesSelector(sg.append('g')\n      .attr('class', 'edgesSelector')\n      .attr('transform', 'translate(' + (nodesSelector.width() + 10) +',0)'));\n\n    sg.append('text')\n      .attr('transform', 'translate(' + (20 + nodesSelector.width() + 10) +',' + (nodesSelector.height() + 5) + ')')\n      .text('relations')\n      .on('click', () => { showEdges = !showEdges; render(); });\n\n\n    let g = svg.append('g');\n\n    svgLinks = g.append('g').attr('class', 'links');\n    svgNodes = g.append('g').attr('class', 'nodes');\n\n    addListeners();\n\n    return g;\n  }\n\n  function addListeners() {\n  }\n\n  let cg = function(selection) {\n    build(selection);\n  };\n\n  cg.width = function(_) {\n    if (!arguments.length) return width;\n    width = _;\n    return this;\n  };\n\n  cg.height = function(_) {\n    if (!arguments.length) return height;\n    height = _;\n    return this;\n  };\n\n  cg.dimension = function(_) {\n    if (!arguments.length) return dimension;\n    dimension = _;\n    group = dimension.group().reduce(\n      (p,v) => { p.push(v); return p; },\n      (p,v) => { p.splice(p.index(v), 1); return p; },\n      () => []);\n    return this;\n  };\n\n  cg.resize = function(size) {\n    width = size[0];\n    height = size[1];\n\n  };\n\n\n  return cg;\n}"]}