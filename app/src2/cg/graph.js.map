{"version":3,"sources":["graph.es6"],"names":[],"mappings":"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","file":"graph.js","sourcesContent":["/**\n * Created by yarden on 8/25/15.\n */\n\nfunction shared(a, b) {\n  let count = 0,\n    ia = 0, ib = 0, // indices\n    na = a.length, nb = b.length,\n    va, vb;\n\n  if (a.length === 0 || b.length === 0) { return count; }\n\n  va = a[0].id;\n  vb = b[0].id;\n  while (true) {\n    if (va < vb) {\n      if (++ia === na) { return count; }\n      va = a[ia].id;\n    } else if (va > vb) {\n      if (++ib === nb) { return count; }\n      vb = b[ib].id;\n    } else { // va== vb\n      count++;\n      if (++ia === na || ++ib === nb) { return count; }\n      va = a[ia].id;\n      vb = b[ib].id;\n    }\n  }\n}\n\nfunction jaccard(a, b) {\n  let s = shared(a, b);\n  return s/(a.length + b.length -s);\n}\n\nexport default function() {\n  let nodes = [];\n  let edges = [];\n  let domain = [];\n  let prob = null;\n  let max = 0;\n\n  let edgeFunc = jaccard;\n\n  function updateNodes() {\n    max = 0;\n    if (prob) {\n      for(let node of nodes) {\n        node.scale = 0;\n        for(let item of node.items) {\n          node.scale += prob.get(item) || 0;\n        }\n        max = Math.max(max, node.scale);\n      }\n    } else {\n      for(let node of nodes) {\n        node.scale = node.items.length;\n        max = Math.max(max, node.scale);\n      }\n    }\n\n    // scale nodes\n    for (let node of nodes) {\n      node.scale /= max;\n    }\n  }\n\n  function recalculate() {\n    updateNodes();\n\n\n    // create edges\n    let n = nodes.length, n1 = n-1,\n      src, dest;\n\n    edges = [];\n    for (let i=0; i<n1; i++) {\n      src = nodes[i];\n      if (src.items.length == 0) continue;\n\n      for (let j=i+1; j<n; j++) {\n        dest = nodes[j];\n        let value = edgeFunc(src.items, dest.items);\n        if (value > 0) {\n          edges.push( {\n            id: src.id + ':' + dest.id,\n            source: src,\n            target: dest,\n            value: value\n          });\n        }\n      }\n    }\n  }\n\n  let graph = {};\n\n  graph.prob = function(_) {\n    prob = _;\n    updateNodes();\n  };\n\n  graph.nodes = function(_) {\n    if (!arguments.length) return nodes;\n    nodes = _;\n    recalculate();\n    return this;\n  };\n\n  graph.edges = function(_) {\n    if (!arguments.length) return edges;\n    edges = _;\n    return this;\n  };\n\n  graph.edgeFunc = function(f) {\n    if (!arguments.length) return edgeFunc;\n    edgeFunc = f;\n  };\n\n  return graph;\n}"]}