{"version":3,"sources":["patients.es6"],"names":[],"mappings":"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","file":"patients.js","sourcesContent":["/**\n * Created by yarden on 8/21/15.\n */\n\nimport crossfilter from 'crossfilter';\n\nlet encounters = crossfilter();\nexport let enc_eid = encounters.dimension(d => d.id); enc_eid.cf = encounters;\nexport let enc_date = encounters.dimension(d => d.date); enc_date.cf = encounters;\nexport let enc_zipcode = encounters.dimension(d => d.zipcode); enc_zipcode.cf = encounters;\n\nlet topics = crossfilter();\nexport let topics_tid = topics.dimension(d => d.id); topics_tid.cf = topics;\nexport let topics_cat = topics.dimension(d => d.category); topics_cat.cf = topics;\nexport let topics_sys = topics.dimension(d => d.system); topics_sys.cf = topics;\n\nlet relations = crossfilter();\nlet rel_eid = relations.dimension(r => r.enc_id);\nlet rel_tid = relations.dimension(r => r.tag_id);\nlet rel_eid_g = rel_eid.group();\nlet rel_tid_g = rel_tid.group();\n\nlet detectors = new Map();\n\nexport function init(topics_) {\n  topics.add(topics_);\n}\n\nexport function set(data) {\n  enc_eid.filterAll();\n  enc_date.filterAll();\n  enc_zipcode.filterAll();\n  encounters.remove();\n  encounters.add(data.encounters);\n\n  rel_eid.filterAll();\n  rel_tid.filterAll();\n  relations.remove();\n  relations.add(data.relations);\n\n  //enc_date.filter( d => d.date >= data.fromDate && d.date <= data.toDate);\n  let tid = new Set();\n  for (let g of rel_tid_g.top(Infinity)) {\n    tid.add(g.key);\n  }\n  topics_tid.filter(t => tid.has(t));\n}\n\nfunction updateTags() {\n  console.log('update tags');\n}\n\nexport function addDetector(name) {\n  let cf = crossfilter();\n  let detector = {name: name, cf: cf, eid: cf.dimension(d => d.eid), prob: cf.dimension(d => d.prob)};\n  detector.eid.cf = cf;\n  detector.prob.cf = cf;\n  detectors.set(name, detector);\n\n  // todo: what to return?\n}\n\nexport function update(dimension) {\n  if (dimension.cf === encounters) {\n    let currentEncounters = enc_eid.top(Infinity);\n\n    for (let detector of detectors.values()) detector.eid.filter(currentEncounters);\n\n    rel_eid.filter(currentEncounters);\n\n    let currentTopics = rel_tid.top(Infinity);\n    topics_tid.filter(currentTopics);\n\n    updateTags();\n  } else if (dimension.cf == topics) {\n    rel_tid.filter(dimension.top(Infinity));\n    enc_eid.filter(rel_eid.top(Infinity));\n    let activeEncounters = enc_eid.top(Infinity);\n    detectors.forEach( detector => { detector.eid.filter(activeEncounters)});\n\n    updateTags();\n    //} else if ( /* is a detector */) {\n    //\n    //} else { /* it's a tags action */\n  }\n}"]}