{"version":3,"sources":["table.es6"],"names":[],"mappings":"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","file":"table.js","sourcesContent":["/**\n * Created by yarden on 12/29/14.\n */\n\nimport * as d3 from 'd3'\nimport {capitalize} from '../utils'\n\nexport default function() {\n  let SORT_OP = [\n    { func: d3.ascending, symbol: \"fa-sort-asc\"},\n    { func: d3.descending, symbol: \"fa-sort-desc\"}\n    ];\n\n  let d3el, header, data;\n  let width, height;\n  let valid = false;\n  let columns = [];\n  let sortCol;\n  let table, thead, tbody;\n  let dispatch = d3.dispatch('click');\n\n  function identity() {\n    return this;\n  }\n\n  function validate() {\n    valid =  d3el && data; // && key; //&& width && height\n  }\n\n  function showSort(name, opt) {\n    let node = header.select('#'+name).select('.fa');\n    if (opt !== false) {\n      node.classed(SORT_OP[1 - opt].symbol, false);\n      node.classed(SORT_OP[opt].symbol, true);\n    }\n    node.style('visibility',opt === false ? 'hidden' : 'visible');\n  }\n\n  function sort(col) {\n    sortCol = col;\n    showSort(col.name,  col.sortOrder);\n\n    let compare = SORT_OP[col.sortOrder].func;\n    let field = sortCol.name;\n    data.sort(function(a, b) { return compare(a[field], b[field]); });\n\n    update();\n  }\n\n  function onSort(col) {\n    if (sortCol && sortCol.name != col.name)\n      showSort(sortCol.name, false);\n    else\n      col.sortOrder = 1-col.sortOrder;\n    sort(col);\n  }\n\n  function update() {\n   if (!valid) return;\n\n    header = thead.selectAll('th').data(columns);\n\n    let colHeader = header.enter()\n      .append('th')\n      .attr('class', function(d) { return d.class; })\n      .append('g')\n      .attr('id', function(d) {return d.name; });\n\n    colHeader.append('text')\n      .text(function(col) { return col.title;} )\n      .on('click', onSort);\n\n    colHeader.append('i')\n      .attr('class', 'fa')\n      .attr('width', '10px')\n      .style('padding-left', '5px');\n\n    header.exit().remove();\n\n    let rows = tbody.selectAll('tr')\n      .data(data);\n\n    rows.enter().append('tr')\n      .selectAll('td')\n      .data(columns);\n\n    rows.exit().remove();\n\n    // update\n    let cells = rows.selectAll('td')\n      .data(function(row) {\n        return columns.map(function(col) {\n          return {col: col.name, value: col.value(row) /*[col.name]*/, klass: col.class, row:row};\n        })\n      });\n\n    cells.enter().append('td')\n      .on('click', function(d) {\n        dispatch.click(d.row);\n      });\n\n    cells\n      .text(function(d) { return d.value; })\n      .attr('class', function(d) { return d.klass;});\n\n    cells.exit().remove();\n  }\n\n  function convert(cols) {\n    cols = typeof cols == 'string' ? cols.split(', ') : cols;\n    return cols.map(function(col) {\n      if (typeof col == 'string')\n        col = {name: col};\n\n      col.title = col.title || capitalize(col.name);\n      col.sortOrder = col.sortOrder || 0;\n      col.value = col.value || function(d) { return d[col.name]; };\n      col.attr = col.attr || function(d) { return d['attr'] && d['attr'][col.name]; }\n      return col;\n    });\n  }\n\n  return {\n\n    el(el) {\n      if (!arguments.length) return d3el;\n      d3el = typeof el == 'string' ? d3.select(el) : el;\n      table = d3el;\n\n      if (width) table.attr('width', width);\n      if (height) table.attr('height', height);\n\n      thead = table.append('thead').append('tr');\n      tbody = table.append('tbody');\n\n      validate();\n      update();\n      return this;\n    },\n\n    width(value) {\n      if (!arguments.length) return width;\n      width = value;\n      if (table) {\n        table.attr('width', width);\n      }\n      return this;\n    },\n\n    height(value) {\n      if (!arguments.length) return height;\n      height = value;\n      if (table) {\n        table.attr('height', height);\n      }\n      return this;\n    },\n\n    data(value) {\n      if (!arguments.length) return data;\n      data = value;\n      if (sortCol) sort(sortCol);\n      validate();\n      update();\n      return this;\n    },\n\n    columns(value) {\n      if (!arguments.length) return columns;\n      columns = convert(value);\n      validate();\n      update();\n      return this;\n    },\n\n    on(type, listener) {\n      dispatch.on(type, listener);\n      return this;\n    },\n\n    update() {\n      update();\n      return this;\n    },\n\n    row(f) {\n      return tbody.selectAll('tr').filter(f);\n    }\n  };\n}\n"]}