{"version":3,"sources":["table.es6"],"names":[],"mappings":"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","file":"table.js","sourcesContent":["/**\n * Created by yarden on 12/29/14.\n */\n\nimport * as d3 from 'd3'\nimport {capitalize} from '../utils'\n\nexport default function() {\n  var SORT_OP = [\n    { func: d3.ascending, symbol: \"fa-sort-asc\"},\n    { func: d3.descending, symbol: \"fa-sort-desc\"}\n    ];\n\n  var d3el, header, data;\n  var width, height;\n  var valid = false;\n  var columns = [];\n  var sortCol;\n  var table, thead, tbody;\n  var dispatch = d3.dispatch('click');\n\n  function identity() {\n    return this;\n  }\n\n  function validate() {\n    valid =  d3el && data; // && key; //&& width && height\n  }\n\n  function showSort(name, opt) {\n    var node = header.select('#'+name).select('.fa');\n    if (opt !== false) {\n      node.classed(SORT_OP[1 - opt].symbol, false);\n      node.classed(SORT_OP[opt].symbol, true);\n    }\n    node.style('visibility',opt === false ? 'hidden' : 'visible');\n  }\n\n  function sort(col) {\n    sortCol = col;\n    showSort(col.name,  col.sortOrder);\n\n    var compare = SORT_OP[col.sortOrder].func;\n    var field = sortCol.name;\n    data.sort(function(a, b) { return compare(a[field], b[field]); });\n\n    update();\n  }\n\n  function onSort(col) {\n    if (sortCol && sortCol.name != col.name)\n      showSort(sortCol.name, false);\n    else\n      col.sortOrder = 1-col.sortOrder;\n    sort(col);\n  }\n\n  function update() {\n   if (!valid) return;\n\n    header = thead.selectAll('th').data(columns);\n\n    var colHeader = header.enter()\n      .append('th')\n      .attr('class', function(d) { return d.class; })\n      .append('g')\n      .attr('id', function(d) {return d.name; });\n\n    colHeader.append('text')\n      .text(function(col) { return col.title;} )\n      .on('click', onSort);\n\n    colHeader.append('i')\n      .attr('class', 'fa')\n      .attr('width', '10px')\n      .style('padding-left', '5px');\n\n    header.exit().remove();\n\n    var rows = tbody.selectAll('tr')\n      .data(data);\n\n    rows.enter().append('tr')\n      .selectAll('td')\n      .data(columns);\n\n    rows.exit().remove();\n\n    // update\n    var cells = rows.selectAll('td')\n      .data(function(row) {\n        return columns.map(function(col) {\n          return {col: col.name, value: row[col.name], class: col.class, row:row};\n        })\n      });\n\n    cells.enter().append('td')\n      .on('click', function(d) {\n        dispatch.click(d.row);\n      });\n\n    cells\n      .text(function(d) { return d.value; })\n      .attr('class', function(d) { return d.class;});\n\n    cells.exit().remove();\n  }\n\n  function convert(cols) {\n    cols = typeof cols == 'string' ? cols.split(', ') : cols;\n    return cols.map(function(col) {\n      if (typeof col == 'string')\n        col = {name: col};\n\n      col.title = col.title || capitalize(col.name);\n      col.sortOrder = col.sortOrder || 0;\n      return col;\n    });\n  }\n\n  function api() {}\n\n  api.el = function(el) {\n    if (!arguments.length) return d3el;\n    d3el = typeof el == 'string' ? d3.select(el) : el;\n    //table = d3el.append('table')\n    //  .classed('table', true);\n    table = d3el;\n\n    if (width) table.attr('width', width);\n    if (height) table.attr('height', height);\n\n    thead = table.append('thead').append('tr');\n    tbody = table.append('tbody');\n\n    validate();\n    update();\n    return this;\n  };\n\n  api.width = function(value) {\n    if (!arguments.length) return width;\n    width = value;\n    if (table) {\n      table.attr('width', width);\n    }\n    return this;\n  };\n\n  api.height = function(value) {\n    if (!arguments.length) return height;\n    height = value;\n    if (table) {\n      table.attr('height', height);\n    }\n    return this;\n  };\n\n  api.data = function(value) {\n    if (!arguments.length) return data;\n    data = value;\n    if (sortCol) sort(sortCol);\n    validate();\n    update();\n    return this;\n  };\n\n  api.columns = function(value) {\n    if (!arguments.length) return columns;\n    columns = convert(value);\n    validate();\n    update();\n    return this;\n  };\n\n  api.on = function(type, listener) {\n    dispatch.on(type, listener);\n    return this;\n  };\n\n  api.update = function() {\n    update();\n    return this;\n  };\n\n  return api;\n}\n"]}