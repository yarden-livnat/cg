{"version":3,"sources":["map.es6"],"names":[],"mappings":"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","file":"map.js","sourcesContent":["/**\n * Created by yarden on 7/3/15.\n */\n\nimport {MAP_DEFAULTS} from 'config';\nimport * as d3 from 'd3';\nimport * as L from 'leaflet';\n\nexport default function (el, opt) {\n\n  let width, height;\n  let population = new Map();\n  let selection;\n  let zipcodes = new Map();\n\n\n  // options = Object.assign({}, MAP_DEFAULTS, opt);\n  let options = MAP_DEFAULTS;\n  let map = new L.Map(el)\n    .addLayer(L.tileLayer(options.mapbox.url, options.mapbox.opt))\n    .setView(options.center, options.zoom);\n\n  let svgContainer = d3.select(map.getPanes().overlayPane)\n    .append(\"svg\")\n      .attr('width', 200)\n      .attr('height', 200);\n\n  let svg = svgContainer.append(\"g\")\n    .attr(\"class\", \"leaflet-zoom-hide\");\n\n  function projectPoint(x, y) {\n    let point = map.latLngToLayerPoint(new L.LatLng(y, x));\n    this.stream.point(point.x, point.y);\n  }\n\n  function initLeaflet() {\n    let transform = d3.geo.transform({point: projectPoint}),\n        path = d3.geo.path().projection(transform);\n\n    d3.json(options.zipcodes_file, (error, collection) => {\n      if (error) {\n        // Todo: better error handling\n        console.error(error);\n        return;\n      }\n\n      collection.features.forEach(d => {\n        zipcodes.set(d.properties.Zip_Code, d);\n      });\n      let feature = svg.selectAll(\"path\")\n        .data(collection.features)\n        .enter().append(\"path\");\n\n      map.on(\"viewreset\", reset);\n      reset();\n\n      function reset() {\n        let bounds = path.bounds(collection),\n            topLeft = bounds[0],\n            bottomRight = bounds[1];\n\n        svgContainer.attr(\"width\", bottomRight[0] - topLeft[0] )\n          .attr(\"height\", bottomRight[1] - topLeft[1])\n          .style(\"left\", topLeft[0] + \"px\")\n          .style(\"top\", topLeft[1] + \"px\");\n\n        svg.attr(\"transform\", \"translate(\" + -topLeft[0] + \",\" + -topLeft[1] + \")\");\n\n        feature.attr(\"d\", path);\n      }\n    });\n  }\n\n  function selectionChanged() {\n    console.log('Map: selection changed');\n  }\n\n  var api = {};\n\n  api.init = function() {initLeaflet(); };\n\n  api.population = function(map) {\n    population = map;\n    return this;\n  };\n\n  api.selection = function(s) {\n    selection = s;\n    selection.on('changed.map', selectionChanged);\n    return this;\n  };\n\n  api.resize = function(w, h) {\n    width = w;\n    height = h;\n\n    svgContainer.attr(\"width\", w).attr(\"height\", h);\n\n    return this;\n  };\n\n  return api;\n}\n"]}