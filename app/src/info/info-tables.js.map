{"version":3,"sources":["info-tables.es6"],"names":[],"mappings":"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","file":"info-tables.js","sourcesContent":["/**\n * Created by yarden on 7/21/15.\n */\n\nimport d3 from 'd3';\nimport postal from 'postal';\n\nimport * as data from '../data';\nimport table from '../components/table';\nimport bar from '../components/bar';\n\nexport default function(opt) {\n  let selection;\n  let bars = bar();\n  let post = postal.channel('events');\n\n  let tagsTable = table('#details-tables', 'tags-table').header([\n    {name: 'name', title: 'Concept', cellAttr: r => r.attr && r.attr.name},\n    //{name: 'category', title: 'Cat'},\n    //{name: 'system', title: 'Sys'},\n    //{name: 'act', attr: 'numeric'},\n    //{name: 'num', title: 'N', attr: 'numeric'},\n    {name: 'encounters', render: bars}\n  ]).on('mouseover', function(d) { post.publish('tag.highlight', d.value);})\n    .on('mouseout', function(d) { post.publish('tag.unhighlight', d.value);});\n\n  function init() {\n    postal.subscribe({channel: 'data', topic: 'changed', callback: dataChanged});\n  }\n\n  function dataChanged() {\n    bars.max(d3.max(data.tags, d => d.items.length));\n    tagsTable.data(data.tags.map(tag => {\n      return {\n        name: tag.concept.label,\n        //category: tag.concept.category,\n        //system: tag.concept.system,\n        //act:  tag.items.length,\n        //num: tag.items.length,\n        //num: tag.items.length,\n        encounters: tag.items.length,\n        tag: tag,\n        attr: {}\n      }\n    }));\n    selectionChanged();\n  }\n\n  function selectionChanged() {\n    let tag, attr = new Map();\n    for (tag of selection.tags()) { attr.set(tag.concept.label, 'selected'); }\n    for (tag of selection.excluded()) { attr.set(tag.concept.label, 'excluded'); }\n\n    let rows = tagsTable.data();\n    if (rows) {\n      let max = 0;\n      for(let row of rows) {\n        row.attr.name = attr.get(row.name);\n        //if (attr.get(row.tag.concept.label) != 'excluded') {\n          row.encounters =   selection.countActive(row.tag.items);\n          max = Math.max(max, row.encounters);\n        //} else {\n        //  row.encounters = row.tag.items.length;\n      }\n      bars.max(max);\n      tagsTable.data(rows);\n    }\n  }\n\n  function updateSelectionList() {\n    let tag, list = [];\n    for (tag of selection.tags()) {\n      list.push({name: tag.concept.label, attr: 'selected'});\n    }\n    for (tag of selection.excluded()) {\n      list.push({name:  tag.concept.label, attr: 'excluded'});\n    }\n\n    let s = d3.select('#selection-list').selectAll('li')\n      .data(list);\n\n    s.enter().append('li');\n    s.text(d => d.name).attr('class', d => d.attr);\n    s.exit().remove();\n  }\n\n  return {\n    init() {\n      init();\n      return this;\n    },\n\n    selection(s) {\n      selection = s;\n      selection.on('changed.info.tables', selectionChanged);\n      return this;\n    },\n\n    resize() {\n      return this;\n    }\n  };\n}"]}