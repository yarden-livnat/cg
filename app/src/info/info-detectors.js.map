{"version":3,"sources":["info-detectors.es6"],"names":[],"mappings":";;;;;;;;;;;;;;;mBAUe,YAAW;;AAExB,QAAM,MAAM,GAAG,EAAE,CAAC;;AAElB,wBAAO,SAAS,CAAC,EAAC,OAAO,EAAE,MAAM,EAAE,KAAK,EAAE,SAAS,EAAE,QAAQ,EAAE,WAAW,EAAC,CAAC,CAAC;;AAE7E,QAAI,QAAQ,GAAG,2BAAU,CAAC;AAC1B,QAAI,aAAa,GAAG,EAAE,CAAC;AACvB,QAAI,KAAK,GAAG,gBAAG,KAAK,CAAC,GAAG,EAAE,CAAC,EAAE,GAAG,GAAC,MAAM,CAAC,CAAC;;AAKzC,QAAI,KAAK,GAAG,gBAAG,MAAM,CAAC,YAAY,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,CACjD,IAAI,CAAC,MAAK,SAAS,CAAC,CACpB,KAAK,EAAE,CACL,MAAM,CAAC,KAAK,CAAC,CACb,IAAI,CAAC,IAAI,EAAE,UAAA,CAAC;aAAI,WAAW,GAAC,CAAC,CAAC,IAAI;KAAA,CAAC,CACnC,IAAI,CAAC,OAAO,EAAE,UAAU,CAAC,CACzB,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;;AAG1B,aAAS,WAAW,GAAG;AACrB,YAAK,KAAK,CAAC,WAAW,EAAC,MAAK,SAAS,CAAC,GAAG,CAAC,UAAA,CAAC;eAAI,CAAC,CAAC,IAAI;OAAA,CAAC,EAAE,MAAK,QAAQ,EAAE,MAAK,MAAM,CAAC,CAChF,IAAI,CAAE,UAAA,KAAK,EAAI;AACd,qBAAa,GAAG,KAAK,CAAC;AACtB,cAAM,EAAE,CAAC;OACV,CAAC,SACI,CAAE,UAAA,CAAC,EAAI;AAAE,eAAO,CAAC,KAAK,CAAC,kBAAkB,EAAE,CAAC,CAAC,CAAC;OAAE,CAAC,CAAC;KAC3D;;AAED,aAAS,MAAM,GAAG;AAChB,UAAI,IAAI,GAAG,EAAE,CAAC;;;;;;AACd,6BAAc,aAAa,8HAAE;cAApB,CAAC;;AACR,cAAI,IAAI,GAAG,KAAK,CAAC,GAAG,CAAC,UAAA,CAAC;mBAAK,EAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAC;WAAC,CAAC,CAAC;;;;;;;AAEhD,kCAAa,CAAC,CAAC,IAAI,mIAAE;kBAAb,CAAC;;AACP,kBAAI,CAAC,CAAC,IAAI,GAAG,GAAG,EAAE;AAChB,oBAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,GAAG,GAAG,CAAA,GAAI,GAAG,GAAG,MAAM,CAAC,EAAE,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;eAC3E;AACD,kBAAI,CAAC,CAAC,OAAO,GAAG,GAAG,EAAE;AACnB,oBAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,OAAO,GAAG,GAAG,CAAA,GAAI,GAAG,GAAG,MAAM,CAAC,EAAE,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;eAC9E;aACF;;;;;;;;;;;;;;;;AACD,cAAI,CAAC,IAAI,CAAE,EAAC,EAAE,EAAE,CAAC,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAC,CAAE,CAAC;SACvC;;;;;;;;;;;;;;;;AAED,cAAQ,CAAC,gBAAG,MAAM,CAAC,YAAY,CAAC,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;KACrE;;AAED,QAAI,GAAG,GAAG,SAAN,GAAG,GAAc,EACpB,CAAA;GACF","file":"info-detectors.js","sourcesContent":["/**\n * Created by yarden on 8/18/15.\n */\n\nimport d3 from 'd3';\nimport postal from 'postal';\n\nimport * as data from '../data'\nimport Detector from '../components/detector';\n\nexport default function() {\n\n  const N_BINS = 20;\n\n  postal.subscribe({channel: 'data', topic: 'changed', callback: dataChanged});\n\n  let detector = Detector();\n  let detectorsData = [];\n  let range = d3.range(0.5, 1, 0.5/N_BINS);\n\n\n\n\n  let enter = d3.select('#detectors').selectAll('div')\n    .data(data.detectors)\n    .enter()\n      .append('div')\n      .attr('id', d => 'detector-'+d.name)\n      .attr('class', 'detector')\n      .call(detector.build);\n\n\n  function dataChanged() {\n    data.fetch('detectors',data.detectors.map(d => d.name), data.fromDate, data.toDate)\n      .then( reply => {\n        detectorsData = reply;\n        update();\n      })\n      .catch( e => { console.error('Detectors error:', e); });\n  }\n\n  function update() {\n    let list = [];\n    for (let d of detectorsData) {\n      let hist = range.map(d => ({x: d, p: 0, s: 0}));\n\n      for(let r of d.rows) {\n        if (r.prob > 0.5) {\n          hist[Math.min(Math.floor((r.prob - 0.5) / 0.5 * N_BINS), N_BINS - 1)].p++;\n        }\n        if (r.similar > 0.5) {\n          hist[Math.min(Math.floor((r.similar - 0.5) / 0.5 * N_BINS), N_BINS - 1)].s++;\n        }\n      }\n      list.push( {id: d.name, data: hist} );\n    }\n\n    detector(d3.select('#detectors').selectAll('.detector').data(list));\n  }\n\n  let api = function() {\n  }\n}"]}